"use strict";(self.webpackChunkwebxrdemo=self.webpackChunkwebxrdemo||[]).push([[210],{2210:(e,n,o)=>{o.r(n),o.d(n,{MainScreen:()=>d,default:()=>f});var t=o(4515),r=o(7378),a=o(2026),i=function(e,n,o,t){return new(o||(o=Promise))((function(r,a){function i(e){try{c(t.next(e))}catch(e){a(e)}}function s(e){try{c(t.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,s)}c((t=t.apply(e,n||[])).next())}))},s=function(e,n){var o,t,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(o=1,t&&(r=2&s[0]?t.return:s[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,s[1])).done)return r;switch(t=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,t=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],t=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},c=function(e,n,o){return i(void 0,void 0,void 0,(function(){var r,a,c,u,l,d,f;return s(this,(function(p){switch(p.label){case 0:return[4,e.createDefaultXRExperienceAsync()];case 1:return(r=p.sent()).baseExperience.featuresManager.enableFeature(t.bxS.PHYSICS_CONTROLLERS,"latest",{xrInput:r.input,physicsProperties:{restitution:.5,impostorSize:.1,impostorType:t.Q03.BoxImpostor},enableHeadsetImpostor:!0}),r.baseExperience.featuresManager.enableFeature(t.bxS.TELEPORTATION,"stable",{xrInput:r.input,floorMeshes:n,pickBlockerMeshes:[]}),a={},c={},u=new t.Pa4,l=new t.zHn(new t.Pa4,new t.Pa4),d=0,f=new t.Pa4,r.input.onControllerAddedObservable.add((function(n){n.onMotionControllerInitObservable.add((function(o){o.onModelLoadedObservable.add((function(p){return i(void 0,void 0,void 0,(function(){var i,p,h;return s(this,(function(s){return n.grip&&"left"===o.handedness&&(i=o.getComponentIds(),(p=o.getComponent(i[3])).onButtonStateChangedObservable.add((function(){p.pressed&&console.log("X pressed!")}))),(h=o.getComponentOfType("squeeze"))&&h.onButtonStateChangedObservable.add((function(){if(h.changes.pressed)if(h.pressed){n.getWorldPointerRayToRef(l,!0),l.direction.scaleInPlace(1.5);var o=n.grip?n.grip.position:n.pointer.position,i=e.meshUnderPointer;r.pointerSelection.getMeshUnderPointer&&(i=r.pointerSelection.getMeshUnderPointer(n.uniqueId)),i&&i.physicsImpostor&&t.fwF.CreateAndStartAnimation("meshmove",i,"position",30,15,i.position.clone(),o.add(l.direction),t.fwF.ANIMATIONLOOPMODE_CONSTANT,new t.sjr(.3,-.75,.7,1.6),(function(){i&&(c[n.uniqueId]=i,a[n.uniqueId]=r.baseExperience.sessionManager.onXRFrameObservable.add((function(){var e=r.baseExperience.sessionManager.currentTimestamp-d;d=r.baseExperience.sessionManager.currentTimestamp,n.getWorldPointerRayToRef(l,!0),l.direction.scaleInPlace(1.5);var o=n.grip?n.grip.position:n.pointer.position;u.copyFrom(o),u.addInPlace(l.direction),u.subtractToRef(f,u),u.scaleInPlace(1e3/e),c[n.uniqueId].position.copyFrom(o),c[n.uniqueId].position.addInPlace(l.direction),f.copyFrom(c[n.uniqueId].position),c[n.uniqueId].physicsImpostor.setLinearVelocity(t.Pa4.Zero()),c[n.uniqueId].physicsImpostor.setAngularVelocity(t.Pa4.Zero())})))}))}else a[n.uniqueId]&&c[n.uniqueId]&&(r.baseExperience.sessionManager.onXRFrameObservable.remove(a[n.uniqueId]),a[n.uniqueId]=null,c[n.uniqueId].physicsImpostor.setLinearVelocity(u))})),[2]}))}))}))}))})),r.baseExperience.onStateChangedObservable.add((function(e){switch(e){case t.kIW.IN_XR:o&&o.cameras.push(r.baseExperience.camera);case t.kIW.ENTERING_XR:case t.kIW.EXITING_XR:case t.kIW.NOT_IN_XR:}})),[2,r]}}))}))},u=function(e,n,o,t){return new(o||(o=Promise))((function(r,a){function i(e){try{c(t.next(e))}catch(e){a(e)}}function s(e){try{c(t.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,s)}c((t=t.apply(e,n||[])).next())}))},l=function(e,n){var o,t,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(o=1,t&&(r=2&s[0]?t.return:s[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,s[1])).done)return r;switch(t=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,t=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],t=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=function(){var e=this;this.createScene=function(n,o){return u(e,void 0,void 0,(function(){var e,o,i,s,d,f,p,h,b,v,y=this;return l(this,(function(w){switch(w.label){case 0:return e=new t.xsS(n),o=new t.SpM(e),n.displayLoadingUI(),[4,(g=o,m=n.loadingScreen,new Promise((function(e){for(var n={models:{},containers:{},textures:{},images:{},sounds:{},cubeTextures:{}},o=function(e){var o=g.addMeshTask(e,"","".concat(window.location.href,"assets/models/"),e);o.onSuccess=function(o){n.models[e]=o},o.onError=function(e){console.log("model load err: ",e)}},t=0,a=["room.glb"];t<a.length;t++)o(a[t]);for(var i=function(e){var o=g.addContainerTask(e,"","".concat(window.location.href,"assets/models/"),e);o.onSuccess=function(o){n.containers[e]=o},o.onError=function(e){console.log("container model load err: ",e)}},s=0,c=[];s<c.length;s++)i(c[s]);for(var u=function(e){var o=g.addCubeTextureTask(e,"".concat(window.location.href,"assets/textures/").concat(e),void 0,void 0,void 0,!0);o.onSuccess=function(o){n.cubeTextures[e]=o},o.onError=function(e){console.log("cube texture load err: ",e)}},l=0,d=[];l<d.length;l++)u(d[l]);for(var f=function(e){var o=g.addBinaryFileTask(e,"".concat(window.location.href,"assets/sounds/").concat(e));o.onSuccess=function(o){n.sounds[e]=o},o.onError=function(e){console.log("sound load err: ",e)}},p=0,h=[];p<h.length;p++)f(h[p]);for(var b=function(e){var o=g.addTextureTask(e,"".concat(window.location.href,"assets/textures/").concat(e),!1,!1);o.onSuccess=function(o){n.textures[e]=o},o.onError=function(e){console.log("texture load err: ",e)}},v=0,y=[];v<y.length;v++)b(y[v]);for(var w=function(e){var o=g.addImageTask(e,"".concat(window.location.href,"assets/images/").concat(e));o.onSuccess=function(o){n.images[e]=o},o.onError=function(e){console.log("texture load err: ",e)}},x=0,I=[];x<I.length;x++)w(I[x]);g.onProgress=function(e,n){if(m){var o=Number((n-e)/n*100).toFixed(0);m.loadingUIText="".concat(n-e," of ").concat(n," loaded"),m instanceof r.b&&(m.progress="".concat(o,"%"))}},g.onFinish=function(o){e(n)},g.load()})))];case 1:for(i=w.sent(),s=function(e){var n=e.getEngine().getRenderingCanvas(),o=!1,r=new t.cEJ("camera",new t.Pa4(0,1.5,0),e);r.attachControl(n,!0),r.applyGravity=!0,r.checkCollisions=!0,r.ellipsoid=new t.Pa4(.2,.8,.2),r.minZ=.01,r.speed=.3,r.angularSensibility=5e3,r.keysUp.push(87),r.keysLeft.push(65),r.keysDown.push(83),r.keysRight.push(68);var a=t.VO7.CreateBox("cameraBody",{height:2,width:1});return a.isVisible=!1,a.parent=r,e.onKeyboardObservable.add((function(e){1===e.type&&"Space"===e.event.code&&o&&(r.cameraDirection.y+=.5,o=!1)})),r.onCollide=function(e){o=!0},r}(e),s.rotation.y=-Math.PI,d=function(e,n){window.CANNON=a;var o="assets/textures/snowy_park.env",r=t.BtG.CreateFromPrefilteredData(o,e);r.coordinatesMode=t.xEZ.SKYBOX_MODE,e.createDefaultEnvironment({skyboxTexture:r,skyboxSize:200,environmentTexture:o});var i=new t.eiL("defaultPipeline",!1,e,[n]);i.samples=4,i.fxaaEnabled=!0,i.sharpenEnabled=!0,i.sharpen.edgeAmount=.9,i.bloomEnabled=!0,i.glowLayerEnabled=!0,i.glowLayer&&(i.glowLayer.intensity=.4),new t.ezm("light",new t.Pa4(0,1,0),e).intensity=.8;var s=new t.Pa4(0,-9.81,0);return e.enablePhysics(s,new t.szy),e.collisionsEnabled=!0,e.gravity=new t.Pa4(0,-.1,0),i}(e,s),f=[],p=i.models["room.glb"],h=0,b=p.loadedMeshes;h<b.length;h++)(v=b[h]).position.y+=.2,v.checkCollisions=!0,"Floor"!==v.name&&"Ground"!==v.name||f.push(v);return[4,new Promise((function(n){return u(y,void 0,void 0,(function(){var o;return l(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,c(e,f,d)];case 1:return o=t.sent(),n(o),[3,3];case 2:return t.sent(),console.log("not able to offer VR"),n(null),[3,3];case 3:return[2]}}))}))}))];case 2:return w.sent(),[2,e]}var g,m}))}))}};const f=new d}}]);
//# sourceMappingURL=210.babylonBundle.js.map