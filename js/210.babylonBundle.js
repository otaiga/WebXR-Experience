"use strict";(self.webpackChunkwebxrdemo=self.webpackChunkwebxrdemo||[]).push([[210],{2210:(e,n,t)=>{t.r(n),t.d(n,{MainScreen:()=>d,default:()=>f});var o=t(4515),r=t(7378),a=t(2026),i=function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((o=o.apply(e,n||[])).next())}))},s=function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},c=function(e,n,t){return i(void 0,void 0,void 0,(function(){var r,a,c,u,l,d,f;return s(this,(function(p){switch(p.label){case 0:return[4,e.createDefaultXRExperienceAsync()];case 1:return(r=p.sent()).baseExperience.featuresManager.enableFeature(o.bxS.PHYSICS_CONTROLLERS,"latest",{xrInput:r.input,physicsProperties:{restitution:.5,impostorSize:.1,impostorType:o.Q03.BoxImpostor},enableHeadsetImpostor:!0}),r.baseExperience.featuresManager.enableFeature(o.bxS.TELEPORTATION,"stable",{xrInput:r.input,floorMeshes:n,pickBlockerMeshes:[]}),a={},c={},u=new o.Pa4,l=new o.zHn(new o.Pa4,new o.Pa4),d=0,f=new o.Pa4,r.input.onControllerAddedObservable.add((function(n){n.onMotionControllerInitObservable.add((function(t){t.onModelLoadedObservable.add((function(p){return i(void 0,void 0,void 0,(function(){var i,p,h;return s(this,(function(s){return n.grip&&"left"===t.handedness&&(i=t.getComponentIds(),(p=t.getComponent(i[3])).onButtonStateChangedObservable.add((function(){p.pressed&&console.log("X pressed!")}))),(h=t.getComponentOfType("squeeze"))&&h.onButtonStateChangedObservable.add((function(){if(h.changes.pressed)if(h.pressed){n.getWorldPointerRayToRef(l,!0),l.direction.scaleInPlace(1.5);var t=n.grip?n.grip.position:n.pointer.position,i=e.meshUnderPointer;r.pointerSelection.getMeshUnderPointer&&(i=r.pointerSelection.getMeshUnderPointer(n.uniqueId)),i&&i.physicsImpostor&&o.fwF.CreateAndStartAnimation("meshmove",i,"position",30,15,i.position.clone(),t.add(l.direction),o.fwF.ANIMATIONLOOPMODE_CONSTANT,new o.sjr(.3,-.75,.7,1.6),(function(){i&&(c[n.uniqueId]=i,a[n.uniqueId]=r.baseExperience.sessionManager.onXRFrameObservable.add((function(){var e=r.baseExperience.sessionManager.currentTimestamp-d;d=r.baseExperience.sessionManager.currentTimestamp,n.getWorldPointerRayToRef(l,!0),l.direction.scaleInPlace(1.5);var t=n.grip?n.grip.position:n.pointer.position;u.copyFrom(t),u.addInPlace(l.direction),u.subtractToRef(f,u),u.scaleInPlace(1e3/e),c[n.uniqueId].position.copyFrom(t),c[n.uniqueId].position.addInPlace(l.direction),f.copyFrom(c[n.uniqueId].position),c[n.uniqueId].physicsImpostor.setLinearVelocity(o.Pa4.Zero()),c[n.uniqueId].physicsImpostor.setAngularVelocity(o.Pa4.Zero())})))}))}else a[n.uniqueId]&&c[n.uniqueId]&&(r.baseExperience.sessionManager.onXRFrameObservable.remove(a[n.uniqueId]),a[n.uniqueId]=null,c[n.uniqueId].physicsImpostor.setLinearVelocity(u))})),[2]}))}))}))}))})),r.baseExperience.onStateChangedObservable.add((function(e){switch(e){case o.kIW.IN_XR:t&&t.cameras.push(r.baseExperience.camera);case o.kIW.ENTERING_XR:case o.kIW.EXITING_XR:case o.kIW.NOT_IN_XR:}})),[2,r]}}))}))},u=function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((o=o.apply(e,n||[])).next())}))},l=function(e,n){var t,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=function(){var e=this;this.createScene=function(n,t){return u(e,void 0,void 0,(function(){var e,t,i,s,d,f,p,h,b,v,y=this;return l(this,(function(g){switch(g.label){case 0:return e=new o.xsS(n),t=new o.SpM(e),n.displayLoadingUI(),[4,(m=t,w=n.loadingScreen,new Promise((function(e){for(var n={models:{},containers:{},textures:{},images:{},sounds:{},cubeTextures:{}},t=function(e){var t=m.addMeshTask(e,"","assets/models/",e);t.onSuccess=function(t){n.models[e]=t},t.onError=function(e){console.log("model load err: ",e)}},o=0,a=["floor.glb"];o<a.length;o++)t(a[o]);for(var i=function(e){var t=m.addContainerTask(e,"","assets/models/",e);t.onSuccess=function(t){n.containers[e]=t},t.onError=function(e){console.log("container model load err: ",e)}},s=0,c=[];s<c.length;s++)i(c[s]);for(var u=function(e){var t=m.addCubeTextureTask(e,"assets/textures/".concat(e),void 0,void 0,void 0,!0);t.onSuccess=function(t){n.cubeTextures[e]=t},t.onError=function(e){console.log("cube texture load err: ",e)}},l=0,d=[];l<d.length;l++)u(d[l]);for(var f=function(e){var t=m.addBinaryFileTask(e,"assets/sounds/".concat(e));t.onSuccess=function(t){n.sounds[e]=t},t.onError=function(e){console.log("sound load err: ",e)}},p=0,h=[];p<h.length;p++)f(h[p]);for(var b=function(e){var t=m.addTextureTask(e,"assets/textures/".concat(e),!1,!1);t.onSuccess=function(t){n.textures[e]=t},t.onError=function(e){console.log("texture load err: ",e)}},v=0,y=[];v<y.length;v++)b(y[v]);for(var g=function(e){var t=m.addImageTask(e,"assets/images/".concat(e));t.onSuccess=function(t){n.images[e]=t},t.onError=function(e){console.log("texture load err: ",e)}},x=0,I=[];x<I.length;x++)g(I[x]);m.onProgress=function(e,n){if(w){var t=Number((n-e)/n*100).toFixed(0);w.loadingUIText="".concat(n-e," of ").concat(n," loaded"),w instanceof r.b&&(w.progress="".concat(t,"%"))}},m.onFinish=function(t){e(n)},m.load()})))];case 1:for(i=g.sent(),s=function(e){var n=e.getEngine().getRenderingCanvas(),t=!1,r=new o.cEJ("camera",new o.Pa4(0,1.5,0),e);r.attachControl(n,!0),r.applyGravity=!0,r.checkCollisions=!0,r.ellipsoid=new o.Pa4(.2,.8,.2),r.minZ=.01,r.speed=.3,r.angularSensibility=5e3,r.keysUp.push(87),r.keysLeft.push(65),r.keysDown.push(83),r.keysRight.push(68);var a=o.VO7.CreateBox("cameraBody",{height:2,width:1});return a.isVisible=!1,a.parent=r,e.onKeyboardObservable.add((function(e){1===e.type&&"Space"===e.event.code&&t&&(r.cameraDirection.y+=.5,t=!1)})),r.onCollide=function(e){t=!0},r}(e),s.rotation.y=-Math.PI,d=function(e,n){window.CANNON=a;var t=o.BtG.CreateFromPrefilteredData("assets/textures/canary_wharf.env",e);t.coordinatesMode=o.xEZ.SKYBOX_MODE,e.createDefaultEnvironment({skyboxTexture:t,skyboxSize:200,environmentTexture:"assets/textures/canary_wharf.env"});var r=new o.eiL("defaultPipeline",!1,e,[n]);r.samples=4,r.fxaaEnabled=!0,r.sharpenEnabled=!0,r.sharpen.edgeAmount=.9,r.bloomEnabled=!0,r.glowLayerEnabled=!0,r.glowLayer&&(r.glowLayer.intensity=.4),new o.ezm("light",new o.Pa4(0,1,0),e).intensity=.8;var i=new o.Pa4(0,-9.81,0);return e.enablePhysics(i,new o.szy),e.collisionsEnabled=!0,e.gravity=new o.Pa4(0,-.1,0),r}(e,s),f=[],p=i.models["floor.glb"],h=0,b=p.loadedMeshes;h<b.length;h++)(v=b[h]).checkCollisions=!0,v.position.y+=.2,f.push(v);return[4,new Promise((function(n){return u(y,void 0,void 0,(function(){var t;return l(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,c(e,f,d)];case 1:return t=o.sent(),n(t),[3,3];case 2:return o.sent(),console.log("not able to offer VR"),n(null),[3,3];case 3:return[2]}}))}))}))];case 2:return g.sent(),[2,e]}var m,w}))}))}};const f=new d}}]);
//# sourceMappingURL=210.babylonBundle.js.map