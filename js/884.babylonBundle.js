"use strict";(self.webpackChunkwebxrdemo=self.webpackChunkwebxrdemo||[]).push([[884],{6884:(e,n,t)=>{t.r(n),t.d(n,{MainScreen:()=>h,default:()=>b});var o=t(8389),r=t(7378),i=!1,a=function(e){return n=void 0,o=void 0,a=function(){var n,o,r,a;return function(e,n){var t,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(e,a)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(s){switch(s.label){case 0:return i?[3,3]:[4,Promise.resolve().then(t.bind(t,1568))];case 1:return s.sent(),[4,t.e(596).then(t.t.bind(t,3596,23))];case 2:s.sent(),i=!0,s.label=3;case 3:return(null===(o=e.debugLayer)||void 0===o?void 0:o.isVisible())?(null===(r=e.debugLayer)||void 0===r||r.hide(),[3,7]):[3,4];case 4:return s.trys.push([4,6,,7]),[4,null===(a=e.debugLayer)||void 0===a?void 0:a.show()];case 5:return s.sent(),[3,7];case 6:return n=s.sent(),console.log(n),[3,7];case 7:return[2]}}))},new((r=void 0)||(r=Promise))((function(e,t){function i(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(n){var t;n.done?e(n.value):(t=n.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((a=a.apply(n,o||[])).next())}));var n,o,r,a},s=t(2026),c=function(e){var n,t,r=null==e?void 0:e.materials.find((function(e){return"Snow"===e.name})),i=o.MeshBuilder.CreateSphere("snowball",{diameter:.3});i.checkCollisions=!0,i.physicsImpostor=new o.PhysicsImpostor(i,o.PhysicsImpostor.SphereImpostor,{mass:1,restitution:.9},e),i.position=new o.Vector3(0,.4,-4),r&&(i.material=r),i.addBehavior((n=i,(t=new o.SixDofDragBehavior).onDragStartObservable.add((function(){n.physicsImpostor&&n.physicsImpostor.sleep()})),t.onDragEndObservable.add((function(){n.physicsImpostor&&n.physicsImpostor.wakeUp()})),t))},u=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((o=o.apply(e,n||[])).next())}))},l=function(e,n){var t,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(e,a)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=function(e,n,t){return u(void 0,void 0,void 0,(function(){var r,i,a,s,d,f,p;return l(this,(function(h){switch(h.label){case 0:return[4,e.createDefaultXRExperienceAsync()];case 1:return(r=h.sent()).baseExperience.featuresManager.enableFeature(o.WebXRFeatureName.PHYSICS_CONTROLLERS,"latest",{xrInput:r.input,physicsProperties:{restitution:.5,impostorSize:.1,impostorType:o.PhysicsImpostor.BoxImpostor},enableHeadsetImpostor:!0}),r.baseExperience.featuresManager.enableFeature(o.WebXRFeatureName.TELEPORTATION,"stable",{xrInput:r.input,floorMeshes:n,pickBlockerMeshes:[]}),i={},a={},s=new o.Vector3,d=new o.Ray(new o.Vector3,new o.Vector3),f=0,p=new o.Vector3,r.input.onControllerAddedObservable.add((function(n){n.onMotionControllerInitObservable.add((function(t){t.onModelLoadedObservable.add((function(h){return u(void 0,void 0,void 0,(function(){var u,h,b;return l(this,(function(l){return n.grip&&"left"===t.handedness&&(u=t.getComponentIds(),(h=t.getComponent(u[3])).onButtonStateChangedObservable.add((function(){h.pressed&&console.log("X pressed!")}))),(b=t.getComponentOfType("squeeze"))&&b.onButtonStateChangedObservable.add((function(){if(b.changes.pressed)if(b.pressed){n.getWorldPointerRayToRef(d,!0),d.direction.scaleInPlace(1.5);var t=n.grip?n.grip.position:n.pointer.position,u=e.meshUnderPointer;r.pointerSelection.getMeshUnderPointer&&(u=r.pointerSelection.getMeshUnderPointer(n.uniqueId)),u&&u.physicsImpostor&&"ground"!==u.name&&o.Animation.CreateAndStartAnimation("meshmove",u,"position",30,15,u.position.clone(),t.add(d.direction),o.Animation.ANIMATIONLOOPMODE_CONSTANT,new o.BezierCurveEase(.3,-.75,.7,1.6),(function(){u&&(a[n.uniqueId]=u,i[n.uniqueId]=r.baseExperience.sessionManager.onXRFrameObservable.add((function(){var e=r.baseExperience.sessionManager.currentTimestamp-f;f=r.baseExperience.sessionManager.currentTimestamp,n.getWorldPointerRayToRef(d,!0),d.direction.scaleInPlace(1.5);var t=n.grip?n.grip.position:n.pointer.position;s.copyFrom(t),s.addInPlace(d.direction),s.subtractToRef(p,s),s.scaleInPlace(1e3/e),a[n.uniqueId].position.copyFrom(t),a[n.uniqueId].position.addInPlace(d.direction),p.copyFrom(a[n.uniqueId].position),a[n.uniqueId].physicsImpostor.setLinearVelocity(o.Vector3.Zero()),a[n.uniqueId].physicsImpostor.setAngularVelocity(o.Vector3.Zero())})))}))}else i[n.uniqueId]&&a[n.uniqueId]&&(setTimeout((function(){for(var n=0,t=e.meshes.filter((function(e){return"snowball"===e.name}));n<t.length;n++)t[n].dispose();c(e)}),2e3),r.baseExperience.sessionManager.onXRFrameObservable.remove(i[n.uniqueId]),i[n.uniqueId]=null,a[n.uniqueId].physicsImpostor.setLinearVelocity(s))})),[2]}))}))}))}))})),r.baseExperience.onStateChangedObservable.add((function(e){switch(e){case o.WebXRState.IN_XR:t&&t.cameras.push(r.baseExperience.camera);case o.WebXRState.ENTERING_XR:case o.WebXRState.EXITING_XR:case o.WebXRState.NOT_IN_XR:}})),[2,r]}}))}))},f=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((o=o.apply(e,n||[])).next())}))},p=function(e,n){var t,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(t=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(e,a)}catch(e){s=[6,e],o=0}finally{t=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},h=function(){var e=this;this.createScene=function(n,t){return f(e,void 0,void 0,(function(){var e,t,i,u,l,h,b,v,y,w,m,g,I=this;return p(this,(function(x){switch(x.label){case 0:return e=new o.Scene(n),t=new o.AssetsManager(e),n.displayLoadingUI(),[4,(S=t,k=n.loadingScreen,new Promise((function(e){for(var n={models:{},containers:{},textures:{},images:{},sounds:{},cubeTextures:{}},t=function(e){var t=S.addMeshTask(e,"","".concat(window.location.href,"assets/models/"),e);t.onSuccess=function(t){n.models[e]=t},t.onError=function(e){console.log("model load err: ",e)}},o=0,i=["snowScene.glb"];o<i.length;o++)t(i[o]);for(var a=function(e){var t=S.addContainerTask(e,"","".concat(window.location.href,"assets/models/"),e);t.onSuccess=function(t){n.containers[e]=t},t.onError=function(e){console.log("container model load err: ",e)}},s=0,c=[];s<c.length;s++)a(c[s]);for(var u=function(e){var t=S.addCubeTextureTask(e,"".concat(window.location.href,"assets/textures/").concat(e),void 0,void 0,void 0,!0);t.onSuccess=function(t){n.cubeTextures[e]=t},t.onError=function(e){console.log("cube texture load err: ",e)}},l=0,d=[];l<d.length;l++)u(d[l]);for(var f=function(e){var t=S.addBinaryFileTask(e,"".concat(window.location.href,"assets/sounds/").concat(e));t.onSuccess=function(t){n.sounds[e]=t},t.onError=function(e){console.log("sound load err: ",e)}},p=0,h=[];p<h.length;p++)f(h[p]);for(var b=function(e){var t=S.addTextureTask(e,"".concat(window.location.href,"assets/textures/").concat(e),!1,!1);t.onSuccess=function(t){n.textures[e]=t},t.onError=function(e){console.log("texture load err: ",e)}},v=0,y=[];v<y.length;v++)b(y[v]);for(var w=function(e){var t=S.addImageTask(e,"".concat(window.location.href,"assets/images/").concat(e));t.onSuccess=function(t){n.images[e]=t},t.onError=function(e){console.log("texture load err: ",e)}},m=0,g=[];m<g.length;m++)w(g[m]);S.onProgress=function(e,n){if(k){var t=Number((n-e)/n*100).toFixed(0);k.loadingUIText="".concat(n-e," of ").concat(n," loaded"),k instanceof r.b&&(k.progress="".concat(t,"%"))}},S.onFinish=function(t){e(n)},S.load()})))];case 1:if(i=x.sent(),u=i.models["snowScene.glb"])for(l=0,h=u.loadedMeshes;l<h.length;l++)h[l].checkCollisions=!0;return b=function(e){var n=e.getEngine().getRenderingCanvas(),t=!1,r=new o.FreeCamera("camera",new o.Vector3(0,1.5,0),e);r.attachControl(n,!0),r.applyGravity=!0,r.checkCollisions=!0,r.ellipsoid=new o.Vector3(.2,.8,.2),r.minZ=.01,r.speed=.3,r.angularSensibility=5e3,r.keysUp.push(87),r.keysLeft.push(65),r.keysDown.push(83),r.keysRight.push(68);var i=o.MeshBuilder.CreateBox("cameraBody",{height:2,width:1});return i.isVisible=!1,i.parent=r,e.onKeyboardObservable.add((function(e){1===e.type&&"Space"===e.event.code&&t&&(r.cameraDirection.y+=.5,t=!1)})),r.onCollide=function(e){t=!0,"deadzone"===e.name&&(r.position=new o.Vector3(0,1.5,0))},r}(e),b.rotation.y=-Math.PI,v=function(e,n){window.CANNON=s;var t="assets/textures/snowy_park.env",r=o.CubeTexture.CreateFromPrefilteredData(t,e);r.coordinatesMode=o.Texture.SKYBOX_MODE,e.createDefaultEnvironment({skyboxTexture:r,skyboxSize:200,environmentTexture:t});var i=new o.DefaultRenderingPipeline("defaultPipeline",!1,e,[n]);i.samples=4,i.fxaaEnabled=!0,i.sharpenEnabled=!0,i.sharpen.edgeAmount=.9,i.bloomEnabled=!0,i.glowLayerEnabled=!0,i.glowLayer&&(i.glowLayer.intensity=.4),new o.HemisphericLight("light",new o.Vector3(0,1,0),e).intensity=.8;var a=new o.Vector3(0,-9.81,0);return e.enablePhysics(a,new o.CannonJSPlugin),e.collisionsEnabled=!0,e.gravity=new o.Vector3(0,-.1,0),i}(e,b),y=e.materials.find((function(e){return"Snow"===e.name})),w=[],(m=o.MeshBuilder.CreateGround("ground",{width:50,height:50,subdivisions:20})).receiveShadows=!0,m.position=new o.Vector3(0,0,0),m.checkCollisions=!0,m.physicsImpostor=new o.PhysicsImpostor(m,o.PhysicsImpostor.BoxImpostor,{mass:0,friction:.8,restitution:.5,disableBidirectionalTransformation:!0},e),w.push(m),y&&(m.material=y),(g=o.MeshBuilder.CreateGround("deadzone",{width:200,height:200,subdivisions:20})).checkCollisions=!0,g.position=new o.Vector3(0,-1,0),g.isVisible=!1,c(e),[4,new Promise((function(n){return f(I,void 0,void 0,(function(){var t;return p(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,d(e,w,v)];case 1:return t=o.sent(),n(t),[3,3];case 2:return o.sent(),console.log("not able to offer VR"),n(null),[3,3];case 3:return[2]}}))}))}))];case 2:return x.sent(),window.addEventListener("keydown",(function(n){return f(I,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return n.ctrlKey&&n.altKey&&"KeyI"===n.code?[4,a(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})),[2,e]}var S,k}))}))}};const b=new h}}]);
//# sourceMappingURL=884.babylonBundle.js.map